
(function(){jQuery(document).ready(function(G){G(".group").hide();G(".section-group").hide();G(".tab-group").hide();G("#mp-option-books").show();var s=G('<div id="curtain"><div class="fb-spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>');G("#bg-content").append(s);G("#confirm_update").on("click",function(aj){G("#update_warning").slideUp(function(){G("#update_warning").remove()});G.post(ajaxurl,{action:"disable_warning"});aj.preventDefault()});G("#request_backup").on("click",function(ak){var aj=ajaxurl+"?action=export_flipbooks";location.href=aj;ak.preventDefault()});G(".wrap").on("click","table.pages-table a.edit-page",function(ak){var aj=G(this);aj.parents(".pages-table").find(".add-page.cancel").each(function(){G(this).trigger("click")});if(!aj.parents("tr.display").next().is(":visible")){b(aj.parents("tr.display").next().find("#rfbwp_page_css"));Z(aj.parents("tr.display").next().find("#field-rfbwp_page_html, #field-rfbwp_page_html_second"));d(aj.parents("tr.display").next().find(".rfbwp-page-toc-popup"));y(aj.parents("tr.display").next())}aj.parents("tr.display").next().slideToggle();aj.parents("tr.display").next().find("a.rfbwp-page-save span.desc").text("Save Changes");aj.parents("tr.display").next().find("a.rfbwp-page-save").attr("href","#Save Changes");ak.preventDefault()});G(".wrap").on("click","table.pages-table a.delete-page",function(an){an.preventDefault();var am=G(this),al=am.parents("div.pages").attr("id"),ao=am.parents("tr.display").attr("id"),aj=am.parents("div.pages"),ak;ac();am.parents("tr.display").slideUp("slow",function(){var ar=am.parents("tr.display").next("tr.page-set").find("input, select, textarea").serializeArray();if(am.parents("tr.display").next().hasClass("page-set")){am.parents("tr.display").next().remove()}am.parents("tr.display").remove();var ap=K(ao);var aq=K(al);G.post(ajaxurl,{action:"save_settings",data:ar,value:"Delete Page",activeID:aq,pageID:ap,curPageID:ap,updating:"delete_page"},function(at){if(at.indexOf("mpc_data_size_exceeded")!=-1){P("red",mpcthLocalize.messages.dialogs.maxInputVars,15000)}J();ad(aj);X(aj);if(aj.find("table.pages-table tr.page-set").length==0){G("li.button-sidebar.selected a").trigger("click");G(".books").hide();ak=setInterval(function(){var au=aj.attr("id");au=K(au);Q();G(".books tr:nth-child("+(parseInt(au)+1)+")").find("a.view-pages").trigger("click");clearInterval(ak)},150)}})})});G(".wrap").on("click","table.pages-table tr.display a.down-page, table.pages-table tr.display a.up-page",function(ao){ao.preventDefault();var ap=G(this),at=ap.parents("tr.display"),al=at.next(),am,ak,aq,ar,an;if(ap.hasClass("up-page")){aq="up"}else{aq="down"}if(aq=="up"){if(al.hasClass("page-set")){am=parseInt(al.find("input#rfbwp_fb_page_index").attr("value"));if(at.prev().find("select.rfbwp-page-type option:selected").text()=="Double Page"){am-=2}else{am-=1}}}else{if(aq=="down"){if(al.hasClass("page-set")){am=parseInt(al.find("input#rfbwp_fb_page_index").attr("value"));if(al.next().next().find("select.rfbwp-page-type option:selected").text()=="Double Page"){am+=2}else{am+=1}}}}if(aq=="down"){if(al.next().hasClass("display")){an=al.next().next()}else{an="error";P("orange",mpcthLocalize.messages.dialogs.bottomPage,2000)}if(an!="error"){at.find("span.page-index").text(am);al.find("input#rfbwp_fb_page_index").attr("value",am);var aj=parseInt(al.next().next().find("input#rfbwp_fb_page_index").attr("value"),10);if(al.find("select.rfbwp-page-type option:selected").text()=="Double Page"){aj-=2}else{aj-=1}al.next().next().find("input#rfbwp_fb_page_index").attr("value",aj);at.slideUp("fast",function(){an.after(al);an.after(at);at.slideDown();m(G(this).parents("div.pages"));X(G(this).parents("div.pages"));al.find("a.rfbwp-page-save").attr("href","#Save Changes");al.find("a.rfbwp-page-save").trigger("click",["move_down"])})}}else{if(aq=="up"){if(at.prev().prev().hasClass("display")){an=at.prev().prev()}else{an="error";P("orange",mpcthLocalize.messages.dialogs.topPage,2000)}if(an!="error"){at.find("span.page-index").text(am);al.find("input#rfbwp_fb_page_index").attr("value",am);var aj=parseInt(at.prev().find("input#rfbwp_fb_page_index").attr("value"),10);if(al.find("select.rfbwp-page-type option:selected").text()=="Double Page"){aj+=2}else{aj+=1}at.prev().find("input#rfbwp_fb_page_index").attr("value",aj);at.slideUp("fast",function(){an.before(at);an.before(al);at.slideDown();m(G(this).parents("div.pages"));X(G(this).parents("div.pages"));al.find("a.rfbwp-page-save").attr("href","#Save Changes");al.find("a.rfbwp-page-save").trigger("click",["move_up"])})}}}});function H(am){var al=am.next(),ao,aj,ak=parseInt(al.find("input#rfbwp_fb_page_index").attr("value"));aj=am.find("span.page-index").text();aj=aj.split("-");aj=parseInt(aj[0]);if(aj>ak){ao="up"}else{ao="down"}if(aj!=ak){var an;am.slideUp();al.remove();am.parents("table.pages-table").find("tr.page-set").each(function(){var ap=G(this);if(ao=="down"){if(ak>=parseInt(ap.find("input#rfbwp_fb_page_index").attr("value"))){an=ap}}else{if(ak>=parseInt(ap.find("input#rfbwp_fb_page_index").attr("value"))){an=ap}}});if(ao=="down"){am.find("span.page-index").text(ak);am.slideUp("fast",function(){an.after(al);an.after(am);am.slideDown();m(G(this).parents("div.pages"));X(G(this).parents("div.pages"))})}else{am.find("span.page-index").text(ak);am.slideUp("fast",function(){an.prev().before(am);an.prev().before(al);am.slideDown();m(G(this).parents("div.pages"));X(G(this).parents("div.pages"))})}}else{m(G(this).parents("div.pages"));X(G(this).parents("div.pages"))}}G(".wrap").on("click","a.add-book",function(aj){aj.preventDefault();G.post(ajaxurl,{action:"add_new_book"},function(ak){var al=parseInt(ak);G("a#mp-option-settings_"+al+"-tab").addClass("add");G("a#mp-option-settings_"+al+"-tab").click();Q();G("div.breadcrumbs span.breadcrumb-1 span.active").fadeIn();G("div.breadcrumbs span.breadcrumb-1").addClass("selected");G("div.breadcrumbs span.breadcrumb-2").fadeOut();y(G("#mp-option-settings_"+al).find('[data-toggle-section="field-rfbwp_fb_name"]'));f("book-settings",al);G("div.bottom-nav").find("a.edit-button").attr("value","Save Settings")})});G(".wrap").on("click","div.pages a.add-page",function(am){am.preventDefault();var al=G(this),aj=al.parents("tr.display").attr("id");al.parents(".pages-table").find("tr.display:not(#"+aj+")").each(function(){G(this).find(".add-page.cancel").trigger("click")});ad(al.parents("table.pages-table"));var an=al.parents("tr.display").next().clone(true);if(al.hasClass("cancel")){al.removeClass("cancel").find("span").text(mpcthLocalize.addNewPage)}else{al.addClass("cancel").find("span").text(mpcthLocalize.cancelNewPage)}if(al.parents("tr.display").next().next().hasClass("page-set")&&al.parents("tr.display").next().next().css("display")!="none"){al.parents("tr.display").next().next().slideUp("slow",function(){G(this).remove();ad(al.parents("table.pages-table"))});return}if(al.parents("tr.display").next().css("display")!="none"){al.parents("tr.display").next().slideUp("slow")}var ak=0;al.parents("tr.display").next().after(an);al.parents("tr.display").next().next().find("select.rfbwp-page-type option").prop("selected");al.parents("tr.display").find(".page-set").slideUp("slow");al.parents("tr.display").next().next().slideDown("slow");al.parents("tr.display").next().next().find("a.rfbwp-page-save span.desc").text("Save Page");al.parents("tr.display").next().next().find("a.rfbwp-page-save").attr("href","#Save Page");ad(al.parents("table.pages-table"));g(al.parents("tr.display").next().next().attr("id"),al.parents(".group.pages").attr("id"))});G(".wrap").on("click","img.rfbwp-first-book",function(aj){aj.preventDefault();G(this).parents(".books").find("a.add-book").trigger("click")});G(".wrap").on("click","div.pages img.rfbwp-first-page",function(an){an.preventDefault();var am=G(this),al,ak,aj;J();G(".page-settings").css({display:"block"});G.post(ajaxurl,{action:"page_form"},function(ao){aj=K(am.parents("div.pages").attr("id"));ak='<div class="rfbwp-add-page-form">';ak+=ao;G.post(ajaxurl,{action:"get_books_page_count",book_id:aj},function(ap){al=parseInt(ap);am.prev().find("#pset_"+al).css({display:"block"});ak=ak.replace(/\[books]\[0]/g,"[books]["+aj+"]");ak=ak.replace(/\[pages\]\[0\]/g,"[pages]["+al+"]");am.prev().find("div#ps_"+al).append(ak);am.fadeOut();am.prev().find("div#ps_"+al).find("div.rfbwp-add-page-form").find("input#rfbwp_fb_page_index").attr("value","0");am.prev().find("div#ps_"+al).find("div.controls").children().each(function(){var at=G(this),ar,aq;if(at.attr("name")!=undefined&&at.attr("name")!=""){ar=at.attr("name");ar=ar.split("[books][");aq=ar[1].split("[pages]");ar=ar[0]+"[books]["+aj+"][pages]"+aq[1];at.attr("name",ar);if(at.attr("id")=="rfbwp_fb_page_index"){at.val(0)}}});b(am.prev().find("div#ps_"+al).find("#rfbwp_page_css"));Z(am.prev().find("div#ps_"+al).find("#field-rfbwp_page_html, #field-rfbwp_page_html_second"));y(am.prev().find("div#ps_"+al));am.prev().find("div#ps_"+al).find("div.rfbwp-add-page-form").slideDown();J()})})});G("form#options-form").submit(function(aj){aj.preventDefault();return false});G(".wrap").on("submit","form#options-form",function(aj){aj.preventDefault();return false});G(".wrap").on("click","a.edit-button-alt",function(aj){G(".bottom-nav .edit-button").trigger("click");aj.preventDefault()});G(".wrap").on("keydown","form#options-form input",function(aj){if(aj.keyCode==13){aj.preventDefault();aj.stopPropagation()}});G(".wrap").on("click","form#options-form input.save-button, form#options-form a.edit-button, a.rfbwp-page-save",function(au,ap){au.preventDefault();var av=G(this),aq,am,aj,ak,an,ax,ao;ac();if(av.parents("div.page-settings").attr("id")!=undefined){am=av.parents("div.page-settings").attr("id");am=K(am)}ak=av.attr("href").toString();ak=ak.split("#");ak=ak[1];an=ak;if(av.parents("div.pages").attr("id")!=undefined){ax=av.parents("div.pages").attr("id")}else{av.parents("form").find("div.settings").each(function(){if(G(this).css("display")=="block"){ax=G(this).attr("id")}})}if(ax==undefined){ao=an}else{ao=K(ax)}var aw="",at=av.parents(".page-set").siblings("#page-display_"+am).length!=0;if(ap!=undefined){aw="move_page"}else{if(am==undefined){aw="book"}else{if(am==0){aw="first_page"}else{if(am!=undefined&&at){aw="edit_page"}else{aw="new_page"}}}}if(av.hasClass("rfbwp-page-save")&&am!="0"){var ar="#page-display_"+(K(av.parents(".page-set").attr("id"))-1);if(av.parents(".pages-table").find(ar+" .add-page").hasClass("cancel")){av.parents(".pages-table").find(ar+" .add-page").removeClass("cancel").find("span").text(mpcthLocalize.addNewPage)}av.parents("tr.page-set").slideUp("down",function(){O(G(this).attr("id"));if(ak=="Save Changes"){H(av.parents("tr.page-set").prev());X(av.parents("div.pages"))}else{X(av.parents("div.pages"));m(av.parents("div.pages"));X(av.parents("div.pages"))}av.trigger("rfbwp.page-save");aq=av.parents("tr.page-set").find("input, select, textarea").serializeArray();al()});G("html, body").animate({scrollTop:av.parents("tr.page-set").prev(".display").offset().top-32},250)}else{if(ap=="sortable"){aw="edit_pages";aq=G("#mp-option-pages_"+an).find("input, select, textarea").serializeArray();al()}else{if(am=="0"){av.parents("tr.page-set").slideUp("down",function(){if(ak=="Save Changes"){H(av.parents("tr.page-set").prev());X(av.parents("div.pages"))}else{X(av.parents("div.pages"))}an="Edit Settings";av.trigger("rfbwp.first-page-save");aq=av.parents("tr.page-set").find("input, select, textarea").serializeArray();al()});G("html, body").animate({scrollTop:av.parents("tr.page-set").prev(".display").offset().top-32},250)}else{an=av.val();if(av.val()!="Save Settings"){G("#mp-option-settings_"+ao).find(".breadcrumb-2").fadeIn()}if(an==""&&av.hasClass("edit-button")||an==undefined&&av.hasClass("edit-button")){an="Edit Settings"}aq=G("#mp-option-settings_"+ao).find("input, select, textarea").serializeArray();al()}}}function al(){G.post(ajaxurl,{action:"save_settings",data:aq,activeID:ao,curPageID:am,updating:aw,value:an,moveDir:ap},function(ay){G(window).trigger("rfbwp-page-updated");if(ay.indexOf("mpc_data_size_exceeded")!=-1){P("red",mpcthLocalize.messages.dialogs.maxInputVars,15000)}J();if(aw=="book"){G("div.group").each(function(){var aA=G(this),aB,az;if(aA.css("display")=="block"&&aA.hasClass("settings")){aB=K(aA.attr("id"));G("#mp-option-settings_"+ao).find(".breadcrumb-2").fadeIn();P("green",mpcthLocalize.messages.dialogs.bookSaved,2000);return false}})}})}return false});G(".wrap").on("rfbwp.firstTabReady",function(aj,ak){G(".books tr:nth-child("+(parseInt(ak)+1)+")").find("a.view-pages").trigger("click")});G(".wrap").on("click","table.books a.delete-book",function(al){al.preventDefault();var ak=G(this),aj=ak.parents("table.books"),am=ak.attr("href").split("#");am=am[1];ac();G.post(ajaxurl,{action:"delete_book",id:am},function(an){if(an.indexOf("mpc_data_size_exceeded")!=-1){P("red",mpcthLocalize.messages.dialogs.maxInputVars,15000)}ak.parent().parent().slideUp(300,function(){ak.parents("tr").remove();aj.parents("form").find("div#mp-option-pages_"+am).remove();aj.parents("form").find("div#mp-option-settings_"+am).remove()});G("li.button-sidebar.selected a").trigger("click",am);J()})});G(".wrap").on("click","div#bg-content div#sidebar ul > li:first-child",function(am,an){am.preventDefault();var al=false,ak=false,aj=false;G("div.field-books span").remove();G("div.field-books table.books").remove();G("div.field-books a.add-book").remove();G("div#top-nav ul#mp-section-flipbooks-tab li").each(function(){var ao=G(this);if(ao.find("a").hasClass("settings")||ao.find("a").hasClass("pages")){ao.remove()}});G("form#options-form div.group").each(function(){var ao=G(this);if(ao.hasClass("settings")||ao.hasClass("pages")){ao.remove()}});G.post(ajaxurl,{action:"rfbwp_refresh_books"},function(ao){G("div.field-books div.controls").children().remove();G("div.field-books div.controls").append(ao);al=true;if(an!=undefined&&an>-1&&al&&ak&&aj){G(".wrap").trigger("rfbwp.firstTabReady",an)}});G.post(ajaxurl,{action:"rfbwp_refresh_tabs"},function(ao){G("div#top-nav ul#mp-section-flipbooks-tab").append(ao);ak=true;if(an!=undefined&&an>-1&&al&&ak&&aj){G(".wrap").trigger("rfbwp.firstTabReady",an)}});G.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(ao){J();G("form#options-form div.group.books").after(ao);G("form#options-form div.group").each(function(){var ap=G(this);if(ap.hasClass("settings")||ap.hasClass("pages")){ap.hide()}});G("#mp-option-books").trigger("rfbwp.ajaxReady");aj=true;if(an!=undefined&&an>-1&&al&&ak&&aj){G(".wrap").trigger("rfbwp.firstTabReady",an)}})});G(".hide-checkbox").each(function(){var ak=G(this).attr("id");var aj=ak.split("_checkbox");if(G(this).attr("checked")=="checked"){G("."+aj[0]+"_wrap").show()}else{G("."+aj[0]+"_wrap").hide()}});G(".hide-checkbox").change(function(){var al=G(this).attr("id");var aj=al.split("_checkbox");if(G(this).attr("checked")=="checked"){G("."+aj[0]+"_wrap").slideDown()}else{G("."+aj[0]+"_wrap").slideUp()}if(G(this).parent().find("div").hasClass("mp-related-object")){var ak=G(this).parent().find("div.mp-related-object").text();G("#"+ak+"_checkbox").attr("checked",false);G("."+ak+"_wrap").slideUp()}});G("textarea.displayall").each(function(){G(this).val(G(this).val())});G("textarea.displayall-upload").each(function(){var ak=G(this).val();var aj=ak.split("http");ak="";G.each(aj,function(al,am){if(al!=0){ak+="http"+am}});G(this).val(ak)});function ae(aj){var ak=K(aj.attr("id")),al=aj.parents(".pages-table");al.find("#"+aj.attr("id")).after(al.find("#pset_"+ak))}function af(aj){console.log("working");var ak=1;aj.find(".stacked-fields:not(:first-child):not(:last-child)").each(function(){var am=G(this),al=am.find(".checkbox").is(":checked");if(al){am.find("#"+am.data("section-id")+"_order input").val(ak);ak++}})}function j(an){var al=an.find(".stacked-fields:first-child"),am=an.find(".stacked-fields:last-child");var ak=an.find(".stacked-fields:not(:first-child):not(:last-child)");var aj=ak.sort(function(ap,ao){var aq=G(ap).find("#"+G(ap).data("section-id")+"_order input").val(),ar=G(ao).find("#"+G(ao).data("section-id")+"_order input").val();return aq>ar});an.append(al);an.append(aj);an.append(am)}function T(am){var ak=0;am.find("tr.display").each(function(){var ap=G(this);if(!ap.next().hasClass("page-set")){ae(ap)}var aq=ap.next(),ao=ap.find(".page-index"),an=aq.find("input#rfbwp_fb_page_index");an.find("input#rfbwp_fb_page_index").attr("value",ak);if(aq.find("select.rfbwp-page-type option:selected").text()==="Double Page"){ao.text(ak+" - "+(ak+1));ak+=2}else{ao.text(ak);ak++}});ad(am.parents("div.pages"));var al=am.parents(".pages").attr("id"),aj=K(al);G(".wrap").find("form#options-form a.edit-button").attr("href","#"+aj).attr("value","Edit Settings");G(".wrap").find("form#options-form a.edit-button").trigger("click",["sortable"])}G(".wrap").on("click",".button-tab a, a.book-settings, a.view-pages",function(am){ac();var al=G(this);al.addClass("selected");var an=al.attr("href");if(al.hasClass("book-settings")){y(G(an).find('[data-toggle-section="field-rfbwp_fb_name"]'));f("book-settings",K(al.attr("href")))}else{if(al.hasClass("books")){f("books")}else{if(al.hasClass("add")){f("add")}else{if(al.hasClass("view-pages")){f("view-pages")}}}}G(".group").hide();var ak;G(an).find("div.page-settings").each(function(){var ao=G(this),ap=ao.attr("id");ap=K(ap);ak=an+" tr#pset_"+ap+" td";G(ak).append(ao);G(an+" tr#pset_"+ap).css({display:"none"})});var aj=K(an);if(aj==undefined){G("#rfbwp_tools").attr("data-book-id","").stop(true,true);G("#rfbwp_import_id").val("")}else{G("#rfbwp_tools").attr("data-book-id",aj).stop(true,true);G("#rfbwp_import_id").val(aj)}if(aj!=undefined){G.post(ajaxurl,{action:"set_active_book",activeID:aj},function(){G(an).trigger("rfbwp.ajaxReady")})}if(al.hasClass("view-pages")){o(G(an));I(G(an));F(G(an))}if(al.hasClass("book-settings")){R(G(an));I(G(an))}G(an).fadeIn();J();am.preventDefault()});G(".group").on("rfbwp.ajaxReady",ai);function ai(aj){G(this).fadeIn(300);s.stop(true).fadeOut(200,function(){ah()})}G(".wrap").on("click",".button-sidebar a",function(al,am){var ak=G(this);if(!ak.parent().hasClass("selected")){G(".button-sidebar").removeClass("selected");ak.parent().addClass("selected");G("div.breadcrumbs").fadeOut()}G(".tab-group").fadeOut("slow");var aj=ak.attr("href")+"-tab .button-tab:first a";G(aj).trigger("click");al.preventDefault()});G(".wrap").on("click","span.breadcrumb",function(an){an.preventDefault();ac();var am=G(this),al=am.parents("div.group"),aj,ak;if(am.hasClass("selected")){if(!am.hasClass("image-batch")){return}else{am.removeClass("image-batch")}}G("span.breadcrumb").each(function(){G(this).removeClass("selected")});ak=K(al.attr("id"));G(".group").hide();if(am.hasClass("breadcrumb-1")){aj="#mp-option-settings_"+ak;R(G(aj));I(G(aj));y(G(aj).find('[data-toggle-section="field-rfbwp_fb_name"]'));G(aj).fadeIn();f("book-settings")}else{if(am.hasClass("breadcrumb-2")){aj="#mp-option-pages_"+ak;o(G(aj));G(aj).find("div.page-settings").each(function(){var aq=G(this),ar=aq.attr("id"),ap="";ar=K(ar);ap=aj+" tr#pset_"+ar+" td";G(ap).append(aq);G(aj+" tr#pset_"+ar).css({display:"none"})});F(G(aj));I(G(aj));var ao=am.parents(".group").attr("id");ao=K(ao);G("li.button-sidebar.selected a").trigger("click",ao);G(".books").hide();G(aj).fadeIn();f("view-pages")}else{if(am.hasClass("breadcrumb-0")){aj="#mp-option-books";f("books-shelf");G(aj).find("div.breadcrumbs").remove();G(aj).fadeIn()}}}J()});var a=[];function b(am){if(!am.parent().find(".rfbwp_page_css_handler").length){var al="rfbwp_css_"+Math.floor(Math.random()*10000),ak=a.length;am.before('<div class="rfbwp_page_css_handler" id="'+al+'" data-index="'+ak+'"></div>');a[ak]=ace.edit(al);var aj=am.hide();a[ak].getSession().setValue(aj.val());a[ak].getSession().setMode("ace/mode/css");a[ak].getSession().on("change",function(){aj.val(a[ak].getSession().getValue())})}}G(".wrap").on("click","#field-rfbwp_fb_page_columns_sc .rfbwp-page-columns-sc",function(){var ak=G(this).parents("tr.page-set").find("#field-rfbwp_page_html_second"),aj=G(this).parents("tr.page-set").find("#field-rfbwp_fb_page_toc_popup_second");ak.toggleClass("active");aj.toggleClass("active")});G(".wrap").on("change","#field-rfbwp_fb_page_type .mp-dropdown",function(){var am=G(this),al=am.parents("tr.page-set"),ak=am.parents("tr.page-set").find("#field-rfbwp_page_html_second"),aj=al.find("#rfbwp_fb_page_type").val();if(aj=="Single Page"&&ak.hasClass("active")){al.find("#field-rfbwp_fb_page_columns_sc a").trigger("click");al.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")}else{if(aj=="Double Page"&&!ak.hasClass("active")){al.find("#field-rfbwp_fb_page_columns_sc").addClass("active");al.find("#field-rfbwp_fb_page_columns_sc a").trigger("click")}}});function Z(ak){var am=ak.parents(".page-settings"),aj=am.find("#rfbwp_fb_page_type").val(),al=ak.parents("tr.page-set").find("#field-rfbwp_page_html_second");ak.find(".html-editor").each(function(){var ao=G(this),ap=ao.parents(".field").attr("id").replace("field-",""),an="rfbwp_html_"+Math.floor(Math.random()*10000);if(tinymce.get(ao.attr("id"))===null){ao.attr("id",an);tinyMCE.init({mode:"exact",relative_urls:false,elements:an,skin:"mpc-flipbook",height:"240px",force_br_newlines:true,force_p_newlines:false,entity_encoding:"raw",verify_html:false,plugins:["autolink lists link image hr anchor","code media nonbreaking paste textcolor colorpicker textpattern"],image_advtab:true,menubar:false,toolbar1:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code",});ao.attr("data-editor",ap)}});if(aj=="Single Page"&&al.hasClass("active")){am.find("#field-rfbwp_fb_page_columns_sc a").trigger("click");am.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")}else{if(aj=="Double Page"&&!al.hasClass("active")){am.find("#field-rfbwp_fb_page_columns_sc").addClass("active");am.find("#field-rfbwp_fb_page_columns_sc a").trigger("click")}}}G(".wrap").on("mousedown","a.rfbwp-page-save",function(){var ak=G(this),aj=ak.parents(".page-settings").find(".html-editor");aj.each(function(){var am=G(this),al=tinyMCE.get(am.attr("id")).getContent().replace(/<p>&nbsp;<\/p>$/,"");tinyMCE.get(am.attr("id")).selection.select(tinyMCE.activeEditor.getBody(),true);tinyMCE.get(am.attr("id")).selection.collapse(false);am.val(al)})});function o(aj){if(aj.find("tr.display").length==0){var ak=aj.find("img.rfbwp-first-page").clone(true);aj.find("img.rfbwp-first-page").remove();aj.find("table.pages-table").after(ak);aj.find("img.rfbwp-first-page").css({display:"inline-block"})}}function t(aj){aj.find(".stacked-fields:not(:first-child):not(:last-child)").append('<div class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></div>');j(aj);aj.sortable({items:"> .stacked-fields:not(:first-child):not(:last-child)",placeholder:"stacked-fields ui-state-highlight",handle:".mpc-sortable-handle"});aj.on("sortupdate",function(ak,al){af(aj)});aj.find(".stacked-fields:not(:first-child):not(:last-child) .checkbox").on("change",function(){af(aj)})}function F(aj){aj.find(".pages-table tbody").sortable({items:"> tr:not(.page-set)",placeholder:"page-set ui-state-highlight",handle:".mpc-sortable-handle"});aj.find(".pages-table tbody").on("sortupdate",function(ak,al){var am=G(this);T(am.parents(".pages-table"))})}function y(aj){aj.find(".field-select").each(function(){var ak=G(this).find(".mp-dropdown");if(!ak.data("select2")){ak.select2({minimumResultsForSearch:10})}})}function w(aj){aj.find(".field-color").each(function(){var ak=G(this);if(!ak.find("input").hasClass("wp-color-picker")){ak.find("input").wpColorPicker()}})}function V(aj){var ak=G("#mpc_icon_select_grid_modal");aj.each(function(){var al=G(this);al.find(".mpc-icon-select").each(function(){var ap=G(this),an=ap.siblings(".mpc-icon-select-clear"),ao=ap.siblings(".mpc-icon-select-value"),am=ap.children("i");ap.on("click",function(aq){if(ak.length){ak.dialog("option","target",ap);ak.dialog("open")}aq.preventDefault()});ap.on("mpc.update",function(ar,aq){ao.val(aq);am.attr("class",aq);ap.removeClass("mpc-icon-select-empty")});an.on("click",function(aq){ao.val("");am.attr("class","");ap.addClass("mpc-icon-select-empty");aq.preventDefault()})})})}function r(am){var aj=G("#mpc_toc_generator_modal"),ak=aj.find("#toc_item_markup").clone().removeAttr("id"),ao=aj.find("#mpc_toc_items").html(""),al=am.parents("#field-rfbwp_pages").find("tr.page-set"),an=0;al.each(function(){var at=G(this),ar=ak.clone(),ap=at.find("#rfbwp_fb_page_title").val(),aq=at.find("#rfbwp_fb_page_index").val();an++;ar.find(".page-checkbox").attr("name","page["+an+"]");ar.find(".page-lp").html(an);ar.find(".page-title").html(ap);ar.find(".page-number").html(aq);ao.append(ar)})}function d(aj){var ak=G("#mpc_toc_generator_modal");aj.each(function(){var al=G(this);al.find(".rfbwp-page-toc-popup").each(function(){var am=G(this);am.on("click",function(an){var ao=am.parents(".field").next().find(".html-editor").attr("id");if(ak.length){r(am);ak.dialog("option","target",ao);ak.dialog("open")}an.preventDefault()})})})}f("books");G(".wrap").on("click","div.mp-toggle-header",function(am){am.preventDefault();var al=G(this),ak=al.next("div.mp-toggle-content");if(al.hasClass("open")){al.removeClass("open")}else{al.addClass("open")}w(ak);V(ak);p(ak);y(ak);e(ak);R(ak);I(ak);var aj=(ak.attr("data-toggle-section")=="field-rfbwp_fb_nav_menu_type");if(aj){t(ak)}al.next("div.mp-toggle-content").slideToggle("slow")});var B=G("#rfbwp_flipbook_batch_ids"),q=G("#rfbwp_flipbook_batch_images_wrap"),u=G("#rfbwp_flipbook_batch_select"),ab=G("#rfbwp_flipbook_batch_ids"),E=G("#rfbwp_flipbook_batch_images_wrap_large"),i=G("#rfbwp_flipbook_batch_select_large"),L=G("#rfbwp_flipbook_batch_import");var x=wp.media;x.view.Settings.Gallery=x.view.Settings.Gallery.extend({render:function(){return this}});G("#rfbwp_flipbook_batch_import").on("click",function(ao){var an=G("#rfbwp_flipbook_batch_ids").val(),al=G("#rfbwp_flipbook_batch_ids_large").val(),aj=(an.match(/,/g)||[]).length+1,am=(al.match(/,/g)||[]).length+1,ak=false;if(an!=""&&al!=""){if(aj!=am){P("red",mpcthLocalize.messages.dialogs.normalLarge,3000)}else{ak=true}}else{if(an==""&&al!=""){ak=true}else{if(an!=""&&al==""){ak=true}else{P("red",mpcthLocalize.messages.dialogs.noImages,3000)}}}if(ak){G.post(ajaxurl,{action:"batch_import",book_id:G("#rfbwp_tools").attr("data-book-id"),images_ids:G("#rfbwp_flipbook_batch_ids").val(),images_ids_large:G("#rfbwp_flipbook_batch_ids_large").val(),double_page:G("#rfbwp_flipbook_batch_double").is(":checked")},function(ap){G("#rfbwp_flipbook_batch_ids").val("");G("#rfbwp_flipbook_batch_images_wrap").html("");G("#rfbwp_flipbook_batch_ids_large").val("");G("#rfbwp_flipbook_batch_images_wrap_large").html("");if(ap=="error-book-id"){P("red","Wrong book ID.",3000)}else{if(ap=="error-page-id"){P("red","Wrong page ID.",3000)}}P("green",mpcthLocalize.messages.dialogs.importFinished,3000);G.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(aq){ac();G("form#options-form .group.settings, form#options-form .group.pages").remove();G("form#options-form div.group.books").after(aq);G("form#options-form div.group").each(function(){var ar=G(this);if(ar.hasClass("settings")||ar.hasClass("pages")){ar.hide()}});G("#mp-option-pages_"+G("#rfbwp_tools").attr("data-book-id")).find(".breadcrumbs .breadcrumb-2").trigger("click");J()})})}ao.preventDefault()});G(".wrap").on("click",".upload_button",function(){if(al){al.open();return}var am=["image/jpeg","image/png","image/gif"],aj=G(this).siblings(".upload"),ak=G(this).siblings(".screenshot");var al=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:false});al.on("select",function(){var an=al.state().get("selection").first().toJSON();if(am.indexOf(an.mime)>=0){aj.val(an.url);ak.find("img:not(.default)").remove();ak.prepend('<img src="'+an.url+'" alt="" />')}});al.open()});G(".wrap").on("click",".upload_file_button",function(){if(al){al.open();return}var ak=G(this).siblings(".uploaded_file_name"),aj=G(this).siblings(".upload");var al=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:false});al.on("select",function(){var am=al.state().get("selection").first().toJSON();aj.val(am.id);ak.html(am.filename)});al.open()});function N(ak){if(ak){var am=new wp.shortcode({tag:"gallery",attrs:{ids:ak},type:"single"});var aj=wp.media.gallery.attachments(am);var al=new wp.media.model.Selection(aj.models,{props:aj.props.toJSON(),multiple:true});al.gallery=aj.gallery;al.more().done(function(){al.props.set({query:false});al.unmirror();al.props.unset("orderby")});return al}return false}G("#rfbwp_flipbook_batch_select, #rfbwp_flipbook_batch_select_large").on("click",function(an){var am="";if(G(this).is("#rfbwp_flipbook_batch_select_large")){am="_large"}var al=G("#rfbwp_flipbook_batch_ids"+am).val(),ak=(al.length>0)?N(al):false,aj=wp.media({title:mpcthLocalize.messages.dialogs.selectImages,button:{text:mpcthLocalize.messages.dialogs.insertImages},frame:"post",state:"gallery-edit",multiple:true,selection:ak});aj.open();aj.on("update",function(at){var ao=at.models,ar=[],ap="";for(var aq=0;aq<ao.length;aq++){ar[aq]=ao[aq].id;ap+='<img width="50px" height="50px" src="'+ao[aq].attributes.sizes.thumbnail.url+'" class="rfbwp-batch-image" alt="Batch image '+aq+'">'}G("#rfbwp_flipbook_batch_ids"+am).val(ar.join(","));G("#rfbwp_flipbook_batch_images_wrap"+am).html(ap)});an.preventDefault()});G("#rfbwp_flipbook_batch_clear, #rfbwp_flipbook_batch_clear_large").on("click",function(ak){var aj="";if(G(this).is("#rfbwp_flipbook_batch_clear_large")){aj="_large"}G("#rfbwp_flipbook_batch_ids"+aj).val("");G("#rfbwp_flipbook_batch_images_wrap"+aj).fadeOut(function(){G("#rfbwp_flipbook_batch_images_wrap"+aj).html("").show()});ak.preventDefault()});G("#rfbwp_tools_toggle_title").on("click",function(al){var ak=G(this),aj=G("#rfbwp_tools_toggle_content");if(ak.is(".option-open")){ak.removeClass("option-open");aj.slideUp()}else{ak.addClass("option-open");aj.slideDown()}al.preventDefault()});var n=G("#rfbwp_page_preview"),h=G("#rfbwp_page_preview_wrap");n.on("click",function(aj){n.fadeOut(250,function(){h.find(".flipbook-container").removeClass("rfbwp-inited");h.html("");n.css("transform","")});n._active=undefined;aj.preventDefault()});G(window).on("rfbwp-page-updated",function(){if(n._active!=undefined){n._active.trigger("click")}});G("#options-form").on("click",".pages .breadcrumbs .breadcrumb:not(.selected)",function(){if(n._active!=undefined){n.trigger("click")}});G("#options-form").on("click",".pages .thumb-preview .preview-page",function(am){var al=G(this),ak=al.parents("div.pages").attr("id"),aj=al.parents(".display").attr("id");n.fadeOut(250,function(){G.post(ajaxurl,{action:"preview_page",book_id:K(ak),page_id:K(aj)},function(an){if(an=="error-book-id"){P("red",mpcthLocalize.messages.dialogs.bookID,3000)}else{if(an=="error-page-id"){P("red",mpcthLocalize.messages.dialogs.bookID,3000)}else{h.html(an);n.fadeIn(250);h.find(".flipbook-container").addClass("rfbwp-inited");console.log(G(window).height(),n.height(),(G(window).height()-100)/n.height());if(n.width()>800){n.css("transform","scale("+(800/n.width()).toFixed(2)+")")}else{if(n.height()>G(window).height()-100){n.css("transform","scale("+((G(window).height()-100)/n.height()).toFixed(2)+")")}}}}})});n._active=al;am.preventDefault()});G("#rfbwp_import_back_url").val(location.href);G("#rfbwp_flipbook_import").on("click",function(aj){G("#rfbwp_import").click();aj.preventDefault()});G("#rfbwp_flipbook_export").on("click",function(ak){var aj=ajaxurl+"?action=export_flipbooks&book_id="+G("#rfbwp_tools").attr("data-book-id");location.href=aj;ak.preventDefault()});function I(aj){aj.find(".fb-dyn-images").each(function(){var ak=G(this);ak.attr("src",ak.attr("data-src"))})}function ah(){var aj=G("#mp-option-books .books td");aj.each(function(al,ak){var an=mpcthLocalize.messages.errors.error;var ap=false;var am=0;var ao=G("#mp-option-pages_"+al+" .pages-table tr:not(.page-set)");ao.each(function(aq,ar){if(G(ar).find(".page-type").html()=="Single Page"){am++}else{am+=2}});if(ao.first().find(".page-type").html()!="Single Page"){an+=mpcthLocalize.messages.errors.firstPage;ap=true}if(ao.last().find(".page-type").html()!="Single Page"){if(ap){an+=", ";ap=false}an+=mpcthLocalize.messages.errors.lastPage;ap=true}if(am<4){if(ap){an+=", ";ap=false}an+=mpcthLocalize.messages.errors.minPages;ap=true}if(am%2!=0){if(ap){an+=", ";ap=false}an+=mpcthLocalize.messages.errors.evenPages}if(an!=mpcthLocalize.messages.errors.error){G(ak).find(".book-error .distinction").html(an+".")}})}function f(aj,ak){Q();G("div.bottom-nav").hide();G("#rfbwp_tools").hide();if(aj=="book-settings"){G("div.bottom-nav").find("a.edit-button").attr("value","Edit Settings").attr("href","#"+ak);G("div.group.settings").find("div.mp-toggle-content:first").css("display","block");G("div.group.settings").find("div.mp-toggle-header:first").addClass("open");G("div.breadcrumbs").fadeIn();G("div.breadcrumbs span.breadcrumb-1").addClass("selected");G("div.breadcrumbs .edit-button-alt").css("display","block");G("div.bottom-nav").fadeIn()}else{if(aj=="books"||aj=="help"){ah();G("div.breadcrumbs").hide();G("div.breadcrumbs .edit-button-alt").hide()}else{if(aj=="add"){G("div.breadcrumbs").fadeIn();G("div.bottom-nav").fadeIn();G("div.breadcrumbs .edit-button-alt").hide()}else{if(aj=="view-pages"){G("div.breadcrumbs").fadeIn();G("div.breadcrumbs span.breadcrumb-2").addClass("selected");G("div.breadcrumbs .edit-button-alt").hide();G("#rfbwp_tools").fadeIn()}else{ag()}}}}}function ag(){ac();G.post(ajaxurl,{action:"rfbwp_refresh_books"},function(aj){G("div.field-books div.controls").children().remove();G("div.field-books div.controls").append(aj);ah();J()})}function O(ak){var aj=K(ak);aj=aj-1;G("table.page-table tr#pset_"+aj).after(G("table.page-table tr#"+ak))}function ad(ak){var aj=-1;var al=-1;ak.find("tr.page-set").each(function(){var an=G(this),am;aj++;al++;if(K(an.attr("id"))!=aj.toString()){an.attr("id","pset_"+aj.toString())}if(an.prev().hasClass("display")&&K(an.prev().attr("id"))!=aj.toString()){an.prev().attr("id","page-display_"+aj.toString())}if(an.find("div.page-settings").attr("id")!=undefined&&K(an.find("div.page-settings").attr("id"))!=aj.toString()){an.find("div.page-settings").attr("id","ps_"+aj.toString())}an.find("div.controls").children().each(function(){var ap=G(this),ao;if(ap.attr("name")!=undefined&&ap.attr("name")!=""){ao=ap.attr("name");ao=ao.split("[pages]");if(ap.hasClass("html-editor")&&ap.attr("data-editor")){ao=ao[0]+"[pages]["+aj+"]["+ap.data("editor")+"]"}else{ao=ao[0]+"[pages]["+aj+"]["+ap.attr("id")+"]"}ap.attr("name",ao)}});an.find("input#rfbwp_fb_page_index").attr("value",al);if(an.find("div#field-rfbwp_fb_page_type select").val()=="Double Page"){al++}})}var Y=G("div.mpc-logo").css("background-image");var c=G.browser;if(c.mozilla||c.msie){Y=Y.split('url("')}else{Y=Y.split("url(")}Y=Y[1];Y=Y.split("massive-panel");Y=Y[0]+"massive-panel/";function X(aj){aj.find("tr.page-set").each(function(){var ap=G(this),an=ap.find("select.rfbwp-page-type option:selected").text(),ak=ap.find("input#rfbwp_fb_page_index").attr("value"),ao=ap.find("input#rfbwp_fb_page_bg_image").attr("value");if(an==undefined||ak==undefined){return}if(ap.prev().hasClass("display")){ap.prev().find("span.page-type").text(an);if(an=="Single Page"){ap.prev().find("span.page-index").text(ak)}else{ap.prev().find("span.page-index").html(ak+" - "+(parseInt(ak)+1))}if(ao!=""){ap.prev().find("td.thumb-preview img").attr("src",ao)}else{ap.prev().find("td.thumb-preview img").attr("src",Y+"images/default-thumb.png")}}else{var al=K(ap.parents("div.pages").attr("id"));var am="";am+='<tr id="page-display_'+ap.parent().find("tr.display").length+'" class="display"><td class="thumb-preview">';if(ao!=""){am+='<img src="'+ao+'" alt=""/>'}else{am+='<div class="no-cover"></div>'}am+='<span class="page-type">'+an+"</span>";am+='<div class="mpc-buttons-wrap page-options">';am+='<a class="add-page mpc-button"><i class="dashicons dashicons-plus"></i> <span class="tooltip">'+mpcthLocalize.addNewPage+"</span></a>";am+='<a class="edit-page mpc-button" href="#'+al+'"><i class="dashicons dashicons-edit"></i> <span class="tooltip">'+mpcthLocalize.editPage+"</span></a>";am+='<a class="preview-page mpc-button" href="#'+al+'"><i class="dashicons dashicons-visibility"></i> <span class="tooltip">'+mpcthLocalize.previewPage+"</span></a>";am+='<a class="delete-page mpc-button" href="#'+al+'"><i class="dashicons dashicons-trash"></i> <span class="tooltip">'+mpcthLocalize.deletePage+"</span></a>";am+='</div></td><td class="navigation">';am+='<a class="up-page mpc-button"><i class="dashicons dashicons-arrow-up-alt2"></i></a>';am+='<input type="checkbox" class="page-checkbox"/>';am+='<span class="desc">page</span>';if(an!="Double Page"){am+='<span class="page-index"><span class="index">'+ak+"</span></span>"}else{am+='<span class="page-index"><span class="index">'+ak+" - "+(parseInt(ak)+1)+"</span></span>"}am+='<a class="down-page mpc-button"><i class="dashicons dashicons-arrow-down-alt2"></i></a>';am+='</td><td class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></td></tr>';ap.before(am);ap.prev().css({display:"none"});ap.prev().slideDown()}})}function g(ao,aj){ao=K(ao);var am=G("table.pages-table tr#pset_"+ao).prev().find("#rfbwp_fb_page_index").attr("value"),an=G("table.pages-table tr#pset_"+ao).prev().find("select.rfbwp-page-type option:selected").attr("value"),al=(an=="Double Page")?parseInt(am)+2:parseInt(am)+1;aj=K(aj);var ak=0;G("table.pages-table tr#pset_"+ao).find(".field").each(function(){ak++;var at=G(this);if(at.find("input").attr("name")!=undefined&&at.find("input").attr("name")!=""){at.find("input").attr("value","")}if(at.attr("id")=="field-rfbwp_fb_page_index"){at.find("#rfbwp_fb_page_index").attr("value",al)}if(at.attr("id")=="field-rfbwp_fb_page_type"){var ap='<select class="mp-dropdown rfbwp-page-type" name="rfbwp_options[books]['+aj+"][pages]["+ao+'][rfbwp_fb_page_type]" id="rfbwp_fb_page_type" title=""><option value="Single Page">Single Page</option><option selected="" value="Double Page">Double Page</option></select>';at.find(".mp-dropdown").remove();at.find(".controls").prepend(ap);y(at.parents("tr#pset_"+ao))}if(at.attr("id")=="field-rfbwp_fb_page_bg_image"||at.attr("id")=="field-rfbwp_fb_page_bg_image_zoom"){at.find("img:not(.default)").remove();at.find("img").show()}if(at.attr("id")=="field-rfbwp_page_html"||at.attr("id")=="field-rfbwp_page_html_second"){var ar=at.find(".html-editor");at.find(".mce-tinymce").remove();ar.val("").show();ar.attr("id","rfbwp_page_html");Z(at);d(at.prev())}if(at.attr("id")=="field-rfbwp_page_css"){if(at.find(".rfbwp_page_css_handler").length>0){at.find(".rfbwp_page_css_handler").attr("id","delete_css_editor");var aq=ace.edit("delete_css_editor");aq.destroy();aq.container.remove()}at.find("#rfbwp_page_css").val("");b(at.find("#rfbwp_page_css"))}})}function m(aj){aj.find("tr.display").each(function(){var an=G(this),am=0,ak,al=an.next();am=parseInt(al.find("input#rfbwp_fb_page_index").attr("value"));if(al.hasClass("page-set")){am=parseInt(al.find("input#rfbwp_fb_page_index").attr("value"));ak=D(am,an);if(ak!=undefined){ak.next().after(an);if(al.hasClass("page-set")){an.after(al)}}}ad(an.parents("table.pages-table"))})}function D(aj,al){var ak;if(aj==""||isNaN(aj)){aj=0}G("table.pages-table tr.display").each(function(){var an=G(this),am=an.next();if(aj>parseInt(am.find("input#rfbwp_fb_page_index").attr("value"))){ak=an}if(aj==am.find("input#rfbwp_fb_page_index").attr("value")&&an.attr("id")!=al.attr("id")){if(am.find("select.rfbwp-page-type option:selected").attr("value")=="Single Page"){aj++}else{if(am.find("select.rfbwp-page-type option:selected").attr("value")==="Double Page"){aj+=2}}al.next().find("input#rfbwp_fb_page_index").attr("value",aj);ak=an}});return ak}function P(al,ao,am){var aj=G("div#bg-content"),ap=G("#wpcontent").offset().left+20+215,ak=G(window).height(),aq=G("#bg-content").height(),an;aj.append('<span class="rfbwp-alert '+al+'">'+ao+"</span>");G("span.rfbwp-alert").css("display","none");if(aq<=ak){G("span.rfbwp-alert").addClass("not-fixed")}else{G("span.rfbwp-alert").removeClass("not-fixed").css({left:ap})}G("span.rfbwp-alert").css("display","block").animate({opacity:1},300);an=setInterval(function(){G("span.rfbwp-alert").animate({opacity:0},300,function(){G("span.rfbwp-alert").css("display","none").remove();clearInterval(an)})},am)}function v(aj,an,ak){var al=G("div#bg-content"),am;al.append('<span class="rfbwp-alert '+aj+'">'+an+"</span>");G("span.rfbwp-alert").hide();G("span.rfbwp-alert").css({top:G(this).scrollTop()+10});G("span.rfbwp-alert").fadeIn("slow");am=setInterval(function(){G("span.rfbwp-alert").fadeOut("slow",function(){G(this).remove();clearInterval(am)})},ak)}function S(){var aj=window.location.href.slice(window.location.href.indexOf("#")+1).split("&");return aj}function K(aj){if(aj!==""){aj=aj.toString();aj=aj.split("_");aj=aj[1]}return aj}function Q(){G("span.breadcrumb").removeClass("selected")}var z=G("#curtain");function ac(){var ak=G("#wpcontent").offset().left+20+405,aj=G(window).height(),al=G("#bg-content").height();if(al<=aj){z.find(".fb-spinner").addClass("not-fixed")}else{z.find(".fb-spinner").removeClass("not-fixed").css({left:ak})}z.css({display:"block"});z.css("visibility","visible");z.stop(true).animate({opacity:1},300)}function J(){z.stop(true).animate({opacity:0},300,function(){z.css("visibility","hidden");z.css("display","none")})}G(".wrap").slideDown(500);var l="",U=[];if(mpcthLocalize.googleFonts==false){G.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?callback=?&key="+mpcthLocalize.googleAPIKey,function(al){if(al.error!=undefined){G("#mpcth_menu_font").after('<div class="mpcth-of-error">'+mpcthLocalize.googleAPIErrorMsg+"</div>")}else{var aj={items:[]};for(var ak=0;ak<al.items.length;ak++){aj.items[ak]={};aj.items[ak].family=al.items[ak].family;aj.items[ak].variants=al.items[ak].variants}jQuery.ajax({type:"POST",url:ajaxurl,action:"mpcth_cache_google_webfonts",google_webfonts:JSON.stringify(aj),dataType:"json"});k(al)}})}else{k(JSON.parse(mpcthLocalize.googleFonts))}function k(am){if(am.items!=undefined){var al=am.items.length;U=am.items;l="";for(var aj=0;aj<al;aj++){var ak=U[aj].family;l+='<option class="mpcth-option-google" data-index="'+aj+'" value="'+ak+'">'+ak+"</option>"}}}function aa(ak){var aj=ak.data.el;aj.siblings(".font-handler").val(aj.val())}function p(aj){aj.each(function(){var ak=G(this);ak.find(".rfbwp-of-input-font").each(function(){var al=G(this);if(!al.data("select2")){al.append(l).select2().select2("val",al.siblings(".font-handler").val()).on("change",{el:al},aa)}})})}function R(aj){aj.find("#rfbwp_fb_hc_fco, #rfbwp_fb_hc_fci, #rfbwp_fb_hc_bco, #rfbwp_fb_hc_bci").each(function(){var ak=G(this);ak[0].name=ak[0].name.replace("[pages][-1]","")})}function W(ak){var aj=ak.parents('.stacked-fields:not([data-section-id="field-rfbwp_fb_nav_menu_type"])');if("field-"+ak.attr("id")==aj.data("section-id")){if(ak.is(":checked")){aj.find(".field:not(#"+aj.data("section-id")+")").css("display","inline-block");aj.find(".field:not(#"+aj.data("section-id")+")").animate({opacity:1},300)}else{aj.find(".field:not(#"+aj.data("section-id")+")").animate({opacity:0},300,function(){aj.find(".field:not(#"+aj.data("section-id")+")").css("display","none")})}}}function e(aj){aj.find(".stacked-fields .checkbox").each(function(){var ak=G(this);W(ak)})}G(".wrap").on("change",".stacked-fields .checkbox",function(){var aj=G(this);W(aj)});G(".wrap").on("change","#rfbwp_fb_pre_style",function(){var al=G(this),ak=al.parents(".group.settings"),aj=al.val();if(aj!=="none"&&aj!==null){C(ak,aj)}});G(".wrap").on("click","#rfbwp_fb_down_preset",function(al){var ak=G(this),aj=ak.parents(".group.settings");M(aj);al.preventDefault()});function C(al,ak){var aj;ac();G.getJSON(mpcthLocalize.presetsURL+ak+".json",function(am){am=am.preset;for(aj=0;aj<am.length-1;aj++){A(al.find("#"+am[aj].field_id),am[aj].value,am[aj].type)}P("green",mpcthLocalize.messages.dialogs.presetLoaded,1500);J()})}function M(an){var ak,am,aj,al={preset:[]};an.find(".field").each(function(){var ao=G(this);if(ao.hasClass("field-checkbox")){am=ao.find('input[type="checkbox"]').prop("checked");ak=ao.find('input[type="checkbox"]').attr("id");aj="checkbox"}else{if(ao.hasClass("field-select")){am=ao.find("select").val();ak=ao.find("select").attr("id");aj="select"}else{if(ao.hasClass("field-font_select")){am=ao.find("input.font-handler").val();ak=ao.find("select").attr("id");aj="font-select"}else{if(ao.hasClass("field-text-small")){am=ao.find("input").val();ak=ao.find("input").attr("id");aj="text"}else{if(ao.hasClass("field-color")){am=ao.find("input").val();ak=ao.find("input").attr("id");aj="color"}else{if(ao.hasClass("field-icon")){am=ao.find("input.mpc-icon-select-value").val();ak=ao.attr("id");aj="icon"}}}}}}al.preset.push({field_id:ak,value:am,type:aj})});al=JSON.stringify(al);console.log(al)}function A(ak,al,aj){if(al==undefined){return}if(aj=="text"){ak.val(al)}else{if(aj=="color"){ak.val(al).trigger("change")}else{if(aj=="select"){ak.val(al).trigger("change")}else{if(aj=="checkbox"){ak.prop("checked",al)}else{if(aj=="icon"){ak.find("input").val(al);ak.find(".mpc-icon-select i").attr("class",al);if(al!=""){ak.find(".mpc-icon-select").removeClass("mpc-icon-select-empty")}}else{if(aj=="font-select"){ak.siblings("input").val(al).trigger("change")}}}}}}}})})();