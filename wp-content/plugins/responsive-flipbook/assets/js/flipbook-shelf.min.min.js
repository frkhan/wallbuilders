
if(typeof convertHex!="function"){function convertHex(g,b){b=b==""?75:b;var c,d,a;g=g.replace("#","");b=b>1?b/100:b;c=parseInt(g.substring(0,2),16);d=parseInt(g.substring(2,4),16);a=parseInt(g.substring(4,6),16);return"rgba("+c+","+d+","+a+","+b+")"}}jQuery(document).ready(function(F){function m(a,b){F.post(rfbwp_ajax,{action:"rfbwp_get_flipbook",rfbwp_id:a},function(c){b.append(c).find("li.fullscreen").remove();b.siblings(".rfbwp-close").addClass("rfbwp-show");G.trigger("rfbwp.shelf");setTimeout(function(){B.removeClass("rfbwp-animate rfbwp-swap");B.fadeOut(200);j=false;k=b.find(".flipbook");b.parent().css("overflow","hidden");setTimeout(function(){b.parent().css("overflow","")},250)},250)})}function x(b){var c=0,d=b.data.shelf.width()-b.data.books.length*20,a=200;b.data.books.each(function(){c+=parseFloat(F(this).attr("data-fb-r"))});a=a<Math.floor(d/c)?a:Math.floor(d/c);b.data.books.each(function(){var e=F(this);e.css({width:Math.floor(a*e.attr("data-fb-r")),height:a})});b.data.shelf.addClass("rfbwp-wrapped")}function E(b,a){B.css({top:b.offset().top-G.scrollTop(),left:b.offset().left,width:b.outerWidth(),height:b.outerHeight()});a.append(B);z()}function C(a){B.show();B.addClass("rfbwp-animate");B.css({top:a.offset().top-G.scrollTop(),left:a.offset().left,width:a.outerWidth(),height:a.outerHeight()});setTimeout(function(){B.remove()},250)}function z(){if(typeof I=="undefined"){return}var K=G.width(),O=G.height(),b=parseInt(I.attr("data-fb-p")),v=parseInt(I.attr("data-fb-w"))*2+b*2,l=parseInt(I.attr("data-fb-h"))+b*2,d=I.is(".rfbwp-hard-cover"),h=I.is(".rfbwp-nav-top"),P=I.is(".rfbwp-nav-aside"),L=parseInt(I.attr("data-fb-n")),c,M,N;if(P&&!H){L=0}M=K-20-(d?20:0);N=O-60-L-(d?20:0)+(!P&&d?10:0);if(v>M){c=M/v;v=M>>0;l=l*c>>0}if(D){v*=2;l*=2}if(l>N){c=v/l;l=N>>0;v=N*c>>0}if(v%2==1){v-=1}if(d){v+=20;l+=20}B.addClass("rfbwp-animate");B.css({top:(N-l)/2+30+(d&&!P?10:0)+(h?L:0),left:(M-v/2)/2+10+(d?15:0),width:v/2,height:l})}function A(){if(k!=undefined){z()}}function q(){clearTimeout(g);g=setTimeout(function(){G.trigger("rfbwp.smart_resize")},100)}var J=F(".rfbwp-shelf");if(!J.length){return}var G=F(window),y=F("html, body"),B,H=G.width()<=768,g,I,k,D,j;G.on("resize",q);J.each(function(){var h=F(this),e=h.find(".rfbwp-shelf-book"),d=h.find(".rfbwp-shelf-cache"),c=h.find(".rfbwp-shelf-box"),f=c.find(".rfbwp-close"),b=c.find(".rfbwp-shelf-wrap");h.prev(".rfbwp-shelf").addClass("rfbwp-stack");h.on("click",".rfbwp-shelf-book",function(o){o.preventDefault();var a=F(this),p=a.attr("data-fb-id"),l=a.attr("data-fb-fs").split("|");if(j){return}j=true;I=a;D=!!(b.width()*0.5*1.25<parseInt(a.attr("data-fb-w"))&&b.width()<600);y.css("overflow","hidden");B=F('<div class="rfbwp-scale"><div class="rfbwp-loader"><div class="rfbwp-circle-one"></div><div class="rfbwp-circle-two"></div></div><img src="'+a.find("img")[0].src+'"></div>');B.attr("style",a.attr("style"));if(a.is(".rfbwp-hard-cover")){B.addClass("rfbwp-hard-cover")}if(F.isArray(l)){c.css({background:convertHex(l[0],l[1])});c.find(".rfbwp-close").attr("data-reverse",l[2])}else{c.removeAttr("style");c.find(".rfbwp-close").removeAttr("data-reverse")}c.addClass("rfbwp-active");E(I,h,b);setTimeout(function(){var i=d.find('.flipbook[data-fb-id="'+p+'"]').parent();if(i.length){i.appendTo(b);G.trigger("rfbwp.resize");j=false;k=i;setTimeout(function(){i.addClass("rfbwp-inited");B.fadeOut(200);f.addClass("rfbwp-show");c.css("overflow","hidden");setTimeout(function(){c.css("overflow","")},250)},250)}else{B.addClass("rfbwp-swap");m(p,b)}},250)});c.on("touchmove",function(a){a.preventDefault()});f.on("mousedown",function(a){a.preventDefault()});f.on("click",function(a){a.preventDefault();if(b.find(".flipbook").length){if(b.find("div.show-all").length){b.find("div.fb-nav").find(".show-all-close").trigger("click")}else{if(b.find("div.zoomed").length){G.trigger("closeZoom")}else{if(j){return}j=true;y.css("overflow","");b.find(".flipbook").trigger("rfbwp.close");f.removeClass("rfbwp-show")}}}});G.on("rfbwp.closed",function(){if(I==undefined){return}if(I.parents(".rfbwp-shelf")[0]!=h[0]){return}c.removeClass("rfbwp-active");C(I);I=undefined;k=undefined;b.find(".flipbook").parent().appendTo(d);setTimeout(function(){j=false},250)});G.on("rfbwp.smart_resize",function(){H=G.width()<=768;A()});x({data:{shelf:h,books:e}});G.on("rfbwp.smart_resize",{shelf:h,books:e},x)})});jQuery(document).ready(function(z){function G(a,b){z.post(rfbwp_ajax,{action:"rfbwp_get_flipbook",rfbwp_id:a},function(c){q.remove();b.append(c);b.siblings(".rfbwp-close").addClass("rfbwp-show");v.trigger("rfbwp.shelf");setTimeout(function(){x=false},250)})}function g(){clearTimeout(E);E=setTimeout(function(){v.trigger("rfbwp.smart_resize")},100)}var y=z(".rfbwp-popup-book");if(!y.length){return}var v=z(window),k=z("html, body"),m=z(".rfbwp-popup"),H=m.find(".rfbwp-popup-cache"),D=m.find(".rfbwp-popup-box"),A=D.find(".rfbwp-close"),j=D.find(".rfbwp-popup-wrap"),q=z('<div class="rfbwp-loader"><div class="rfbwp-circle-one"></div><div class="rfbwp-circle-two"></div></div>'),B=v.width()<=768,E,C,F,x;v.on("resize",g);y.on("click",function(a){a.preventDefault();var b=z(this),e=b.attr("data-fb-id"),d=b.attr("data-fb-fs").split("|");if(x){return}x=true;C=b;F=!!(j.width()*0.5*1.25<parseInt(b.attr("data-fb-w"))&&j.width()<600);k.css("overflow","hidden");if(z.isArray(d)){D.css({background:convertHex(d[0],d[1])});D.find(".rfbwp-close").attr("data-reverse",d[2])}else{D.removeAttr("style");D.find(".rfbwp-close").removeAttr("data-reverse")}D.addClass("rfbwp-active");setTimeout(function(){var c=H.find('.flipbook[data-fb-id="'+e+'"]').parent();if(c.length){c.appendTo(j);v.trigger("rfbwp.resize");x=false;setTimeout(function(){c.addClass("rfbwp-inited");A.addClass("rfbwp-show")},250)}else{j.append(q);G(e,j)}},250)});D.on("touchmove",function(a){a.preventDefault()});A.on("mousedown",function(a){a.preventDefault()});A.on("click",function(a){a.preventDefault();if(j.find(".flipbook").length){if(j.find("div.show-all").length){j.find("div.fb-nav").find(".show-all-close").trigger("click")}else{if(j.find("div.zoomed").length){v.trigger("closeZoom")}else{if(x){return}x=true;k.css("overflow","");j.find(".flipbook").trigger("rfbwp.close");A.removeClass("rfbwp-show")}}}});v.on("rfbwp.closed",function(){if(C==undefined){return}D.removeClass("rfbwp-active");C=undefined;j.find(".flipbook").parent().appendTo(H);setTimeout(function(){x=false},250)});v.on("rfbwp.popup",function(){y=z(".rfbwp-popup-book")});v.on("rfbwp.smart_resize",function(){B=v.width()<=768})});